<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Celestial Architect</title>
    <style>
      /* --- Google Fonts for a Fantasy/Steampunk Feel --- */
      @import url("https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=EB+Garamond:ital,wght@0,400;0,600;1,400&display=swap");

      /* --- Keyframe Animations --- */
      @keyframes rotate-gear-slow {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
      @keyframes fade-in {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* --- Base Styles --- */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html {
        scroll-behavior: smooth;
      }
      body {
        font-family: "EB Garamond", serif;
        color: #d9e1e8;
        background-color: #000000;
      }

      /* --- Wrapper to overlay header and hero --- */
      .hero-wrapper {
        display: grid;
        grid-template-areas: "main";
      }
      .hero-wrapper > * {
        grid-area: main;
      }

      /* --- Sticky Shrinking Header --- */
      header {
        position: sticky;
        top: 0;
        z-index: 100;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 40px 5vw;
        background: transparent;
        transition: padding 0.4s ease-out, background-color 0.4s ease-out,
          backdrop-filter 0.4s ease-out;
        will-change: padding;
        align-self: start;
      }
      header.shrunk {
        padding: 15px 5vw;
        background-color: rgba(15, 20, 30, 0.7);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
      }

      .logo {
        font-family: "Cinzel Decorative", cursive;
        font-size: 1.8rem;
        color: #eaeff2;
        text-shadow: 0px 0px 10px rgba(234, 239, 242, 0.5);
        transition: font-size 0.4s ease-out;
      }
      header.shrunk .logo {
        font-size: 1.5rem;
      }

      /* --- Sidebar Menu & Icon Styles (UPDATED) --- */
      .menu-container {
        position: fixed;
        top: 25px;
        right: 2vw;
        z-index: 210; /* Increased z-index for the container */
      }
      #menu-toggle {
        background: rgba(15, 20, 30, 0.5);
        border: 1px solid #a9b4c2;
        padding: 10px;
        border-radius: 2px;
        cursor: pointer;
        transition: all 0.3s ease;
        line-height: 0;
        position: relative;
        z-index: 2;
      }
      #menu-toggle:hover {
        background: #a9b4c2;
        box-shadow: 0 0 15px #a9b4c2;
      }
      #menu-toggle:hover .menu-icon {
        filter: invert(1);
      }
      .menu-icon {
        width: 28px;
        height: 28px;
        display: block;
        transition: transform 0.3s ease;
      }
      #menu-toggle:hover .menu-icon {
        transform: rotate(45deg);
      }

      .dropdown-menu {
        position: fixed;
        top: 85px; /* Positioned below the toggle button */
        right: 2vw; /* Aligned with the container */
        background-color: rgba(15, 20, 30, 0.85);
        backdrop-filter: blur(8px);
        border: 1px solid #a9b4c2; /* Using a full border */
        border-radius: 4px;
        width: 250px;
        z-index: 1;
        visibility: hidden;
        opacity: 0;
        transform: translateX(100%); /* Start off-screen to the right */
        transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s;
        height: calc(
          100vh - 95px
        ); /* Full height minus top offset and bottom margin */
        overflow-y: auto;
        overscroll-behavior: contain; /* <<< THIS IS THE FIX */
      }
      .dropdown-menu.show {
        visibility: visible;
        opacity: 1;
        transform: translateX(0); /* Slides into view */
      }
      .dropdown-menu ul {
        list-style: none;
      }
      .dropdown-menu ul li a {
        display: block;
        padding: 12px 20px;
        color: #d9e1e8;
        text-decoration: none;
        font-size: 1.1rem;
        transition: background-color 0.3s ease, color 0.3s ease;
      }
      .dropdown-menu ul li a:hover {
        background-color: #a9b4c2;
        color: #0c101c;
      }
      .dropdown-menu::-webkit-scrollbar {
        width: 8px;
      }
      .dropdown-menu::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.2);
      }
      .dropdown-menu::-webkit-scrollbar-thumb {
        background: #a9b4c2;
        border-radius: 4px;
      }
      .dropdown-menu::-webkit-scrollbar-thumb:hover {
        background: #d9e1e8;
      }

      /* --- Hero Section Styles --- */
      #hero {
        height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 0 20px;
        background-image: linear-gradient(
            rgba(10, 15, 25, 0.6),
            rgba(5, 8, 15, 0.8)
          ),
          url(https://images.unsplash.com/photo-1464802686167-b939a6910659);
        background-size: cover;
        background-position: center center;
        z-index: 1;
      }
      #hero h1 {
        font-family: "Cinzel Decorative", cursive;
        font-size: 4rem;
        color: #eaeff2;
        text-shadow: 0px 0px 20px rgba(234, 239, 242, 0.6);
        animation: fade-in 1.5s ease-out;
      }
      #hero p {
        font-size: 1.3rem;
        max-width: 600px;
        margin-top: 20px;
        animation: fade-in 1.8s ease-out;
      }

      /* --- Main Scrolling Container --- */
      .story-container {
        height: 500vh;
        position: relative;
        z-index: 1;
      }

      /* --- Parallax Screen Styling --- */
      .screen {
        height: 100vh;
        width: 100%;
        position: sticky;
        top: 0;
        display: flex;
        align-items: center;
        overflow: hidden;
        background-size: cover;
        background-position: center center;
        will-change: transform;
      }
      #screen1 {
        background-image: linear-gradient(
            rgba(10, 15, 25, 0.6),
            rgba(5, 8, 15, 0.8)
          ),
          url(https://images.pexels.com/photos/1169754/pexels-photo-1169754.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2);
      }
      #screen2 {
        background-image: linear-gradient(
            rgba(30, 20, 50, 0.7),
            rgba(10, 5, 20, 0.9)
          ),
          url(https://images.pexels.com/photos/1252890/pexels-photo-1252890.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2);
      }
      #screen3 {
        background-image: linear-gradient(
            rgba(49, 57, 62, 0.6),
            rgba(75, 70, 91, 0.9)
          ),
          url(https://images.unsplash.com/photo-1592035659284-3b39971c1107);
      }
      #screen4 {
        background-image: linear-gradient(
            rgba(20, 40, 60, 0.7),
            rgba(5, 15, 25, 0.9)
          ),
          url(https://images.unsplash.com/photo-1538370965046-79c0d6907d47);
      }
      #screen5 {
        background-image: linear-gradient(
            rgba(20, 50, 60, 0.7),
            rgba(5, 20, 25, 0.9)
          ),
          url(https://images.unsplash.com/photo-1464802686167-b939a6910659);
      }
      .screen.align-left {
        justify-content: flex-start;
      }
      .screen.align-right {
        justify-content: flex-end;
      }

      .content-box {
        width: 45%;
        max-width: 600px;
        padding: 40px;
        background: rgba(15, 20, 30, 0.5);
        border-top: 2px solid #a9b4c2;
        border-bottom: 2px solid #a9b4c2;
        box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.8),
          0 10px 25px rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(8px);
        animation: fade-in 1.5s ease-out;
        transform: translateZ(0);
        margin: 0 5vw;
      }
      .content-box h2 {
        font-family: "Cinzel Decorative", cursive;
        font-size: 2.5rem;
        color: #eaeff2;
        text-shadow: 0px 0px 15px rgba(234, 239, 242, 0.5);
        margin-bottom: 20px;
        text-align: center;
      }
      .content-box p {
        font-size: 1.2rem;
        line-height: 1.7;
        text-align: justify;
      }

      .screen::before,
      .screen::after {
        content: "⚙";
        font-size: 30vh;
        color: rgba(255, 255, 255, 0.02);
        position: absolute;
        z-index: -1;
        animation: rotate-gear-slow 80s linear infinite;
      }
      .screen::before {
        top: -5vh;
        left: -5vh;
        animation-duration: 120s;
      }
      .screen::after {
        bottom: -10vh;
        right: -10vh;
        font-size: 50vh;
        animation-duration: 90s;
        animation-direction: reverse;
      }

      /* --- Navigation Arrows Styling --- */
      .navigation {
        position: fixed;
        top: 50%;
        right: 2vw;
        transform: translateY(-50%);
        z-index: 110;
        display: flex;
        flex-direction: column;
      }
      .nav-arrow {
        padding: 10px 8px;
        margin: 6px 0;
        background: rgba(15, 20, 30, 0.5);
        border: 1px solid #a9b4c2;
        cursor: pointer;
        transition: all 0.3s ease;
        user-select: none;
        border-radius: 2px;
        line-height: 0;
      }
      .nav-arrow svg {
        width: 28px;
        height: 28px;
        fill: #a9b4c2;
        transition: fill 0.3s ease;
      }
      #nav-up svg {
        transform: rotate(-90deg);
      }
      #nav-down svg {
        transform: rotate(90deg);
      }
      .nav-arrow:hover {
        background: #a9b4c2;
        box-shadow: 0 0 15px #a9b4c2;
      }
      .nav-arrow:hover svg {
        fill: #0c101c;
      }
      .nav-arrow.hidden {
        opacity: 0.2;
        pointer-events: none;
      }

      /* --- Mute Button Styles --- */
      #mute-toggle {
        position: fixed;
        bottom: 25px;
        right: 2vw;
        z-index: 200;
        background: rgba(15, 20, 30, 0.5);
        border: 1px solid #a9b4c2;
        padding: 10px;
        border-radius: 2px;
        transition: all 0.3s ease;
        cursor: pointer;
        line-height: 0;
      }
      #mute-toggle:hover {
        background: #a9b4c2;
        box-shadow: 0 0 15px #a9b4c2;
      }
      #mute-toggle:hover svg {
        fill: #0c101c;
      }
      #mute-toggle svg {
        width: 28px;
        height: 28px;
        fill: #a9b4c2;
        display: block;
        transition: fill 0.3s ease;
      }

      /* --- Final Content Section Styles --- */
      #final-content {
        padding-top: 100px;
        text-align: center;
        background-color: #05080f;
        position: relative;
        z-index: 5;
      }
      #final-content h2 {
        font-family: "Cinzel Decorative", cursive;
        font-size: 3rem;
        color: #eaeff2;
        text-shadow: 0px 0px 20px rgba(234, 239, 242, 0.6);
        margin-bottom: 25px;
      }
      #final-content p {
        font-size: 1.2rem;
        line-height: 1.8;
        max-width: 800px;
        margin: 0 auto 30px auto;
        color: #a9b4c2;
      }
      .cta-button {
        display: inline-block;
        padding: 15px 35px;
        border: 1px solid #a9b4c2;
        background: transparent;
        color: #eaeff2;
        text-decoration: none;
        font-family: "Cinzel Decorative", cursive;
        font-size: 1.1rem;
        transition: all 0.4s ease;
        cursor: pointer;
      }
      .cta-button:hover {
        background: #a9b4c2;
        color: #0c101c;
        box-shadow: 0 0 20px #a9b4c2;
      }

      /* --- Footer Styles --- */
      footer {
        padding: 40px 5vw;
        background-color: #000;
        text-align: center;
        border-top: 1px solid #a9b4c2;
        z-index: 5;
        position: relative;
      }
      .footer-links {
        margin-bottom: 15px;
      }
      .footer-links a {
        color: #a9b4c2;
        text-decoration: none;
        margin: 0 15px;
        transition: color 0.3s ease;
      }
      .footer-links a:hover {
        color: #eaeff2;
      }
      .footer-copyright {
        color: #a9b4c2;
        font-size: 0.9rem;
      }

      /* --- Responsive adjustments --- */
      @media (max-width: 768px) {
        .content-box {
          width: 85%;
          max-width: none;
          margin: 0 7.5vw;
        }
        #hero h1 {
          font-size: 3rem;
        }
        #final-content h2 {
          font-size: 2.5rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="menu-container">
      <div id="menu-toggle">
        <img src="/media/images/menuIcon.png" alt="Menu" class="menu-icon" />
      </div>
      <div class="dropdown-menu" id="dropdown-menu">
        <ul>
          <li><a href="#">Chapter I: The Spark</a></li>
          <li><a href="#">Chapter II: The Nebula</a></li>
          <li><a href="#">Chapter III: The Star</a></li>
          <li><a href="#">Chapter IV: The Planets</a></li>
          <li><a href="#">Chapter V: The Whisper</a></li>
          <li><a href="#">Lore Entry #01</a></li>
          <li><a href="#">Lore Entry #02</a></li>
          <li><a href="#">Lore Entry #03</a></li>
          <li><a href="#">Lore Entry #04</a></li>
          <li><a href="#">Lore Entry #05</a></li>
          <li><a href="#">Bestiary: Star Mites</a></li>
          <li><a href="#">Bestiary: Gas Giants</a></li>
          <li><a href="#">Characters: The Architect</a></li>
          <li><a href="#">Concepts: Celestial Forge</a></li>
          <li><a href="#">Concepts: Grand Orrery</a></li>
          <li><a href="#">The Art of Creation</a></li>
          <li><a href="#">Behind the Scenes</a></li>
          <li><a href="#">The Artist's Sketchbook</a></li>
          <li><a href="#">Design Philosophy</a></li>
          <li><a href="#">Soundtrack Information</a></li>
          <li><a href="#">Gallery</a></li>
          <li><a href="#">About the Author</a></li>
          <li><a href="#">Contact</a></li>
          <li><a href="#">Support the Project</a></li>
          <li><a href="#">Credits</a></li>
        </ul>
      </div>
    </div>

    <div class="hero-wrapper">
      <header>
        <div class="logo">The Celestial Architect</div>
      </header>

      <section id="hero">
        <h1>A Story Written in the Stars</h1>
        <p>Scroll down to witness the creation of the cosmos.</p>
      </section>
    </div>

    <div class="navigation">
      <div class="nav-arrow" id="nav-up">
        <svg viewBox="0 0 100 100">
          <path
            d="M100 50 L80 35 V 20 C 70 25, 60 15, 50 15 H 40 L 40 0 L 25 25 L 0 25 L 0 35 L 70 35 V 45 L 20 45 L 20 55 L 70 55 V 65 L 0 65 L 0 75 L 25 75 L 40 100 V 85 H 50 C 60 85, 70 75, 80 80 V 65 L 100 50 Z" />
        </svg>
      </div>
      <div class="nav-arrow" id="nav-down">
        <svg viewBox="0 0 100 100">
          <path
            d="M100 50 L80 35 V 20 C 70 25, 60 15, 50 15 H 40 L 40 0 L 25 25 L 0 25 L 0 35 L 70 35 V 45 L 20 45 L 20 55 L 70 55 V 65 L 0 65 L 0 75 L 25 75 L 40 100 V 85 H 50 C 60 85, 70 75, 80 80 V 65 L 100 50 Z" />
        </svg>
      </div>
    </div>

    <main>
      <div class="story-container">
        <section class="screen align-left" id="screen1">
          <div class="content-box">
            <h2>The Silent Void</h2>
            <p>
              Before time had a name, there was only an endless, patient
              darkness. It was not empty, but filled with a silent,
              sleeping potential—a cosmic dust awaiting a purpose.
            </p>
          </div>
        </section>
        <section class="screen align-right" id="screen2">
          <div class="content-box">
            <h2>The Cosmic Forge</h2>
            <p>
              From that initial spark, a great celestial forge was born.
              Here, the Architect gathered the sleeping dust, heating and
              molding it with impossible forces into the first swirling
              clouds of a vibrant nebula.
            </p>
          </div>
        </section>
        <section class="screen align-left" id="screen3">
          <div class="content-box">
            <h2>Ignition</h2>
            <p>
              At the heart of the swirling nebula, pressures mounted
              until a critical point was reached. With a silent,
              brilliant flash, the first star ignited, casting light and
              warmth into the void for the very first time.
            </p>
          </div>
        </section>
        <section class="screen align-right" id="screen4">
          <div class="content-box">
            <h2>The Grand Orrery</h2>
            <p>
              The star's birth sent ripples through the cosmos, causing
              dust and gas to coalesce into spheres. The Architect guided
              these nascent worlds, setting them into a graceful,
              clockwork dance—a grand orrery of planets.
            </p>
          </div>
        </section>
        <section class="screen align-left" id="screen5">
          <div class="content-box">
            <h2>The Final Whisper</h2>
            <p>
              On one such world, a blue and green marble tucked away in a
              quiet arm of the new galaxy, the Architect imparted a
              final, gentle whisper. It was the whisper of life, the
              beginning of a new story altogether.
            </p>
          </div>
        </section>
      </div>

      <section id="final-content">
        <h2>The Endless Expanse</h2>
        <p>
          The Architect's work is never truly finished. Countless other
          galaxies await their spark, each a blank canvas for a new cosmic
          masterpiece. The story you have witnessed is but one verse in an
          infinite celestial poem, a reminder that creation is an eternal,
          unfolding process.
        </p>
        <a href="#" class="cta-button">Explore Other Creations</a>
        <br /><br /><br /><br /><br />
        <footer>
          <div class="footer-links">
            <a href="#">About</a>
            <a href="#">Contact</a>
            <a href="#">Support</a>
          </div>
          <div class="footer-copyright">
            &copy; 2025 The Celestial Architect. All Rights Reserved.
          </div>
        </footer>
      </section>
    </main>

    <audio id="bg-music" loop>
      <source src="/media/audios/bgm.mp3" type="audio/mpeg" />
    </audio>
    <button id="mute-toggle"></button>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // --- Header Shrink Logic (unchanged) ---
        const header = document.querySelector("header");
        window.addEventListener("scroll", () => {
          if (window.scrollY > 150) header.classList.add("shrunk");
          else header.classList.remove("shrunk");
        });

        // --- Dropdown Menu Logic (unchanged) ---
        const menuToggle = document.getElementById("menu-toggle");
        const dropdownMenu = document.getElementById("dropdown-menu");
        menuToggle.addEventListener("click", function (event) {
          event.stopPropagation();
          dropdownMenu.classList.toggle("show");
        });
        window.addEventListener("click", function (event) {
          if (
            !menuToggle.contains(event.target) &&
            !dropdownMenu.contains(event.target)
          ) {
            dropdownMenu.classList.remove("show");
          }
        });

        // --- Audio Player Logic (unchanged) ---
        const audio = document.getElementById("bg-music");
        const muteBtn = document.getElementById("mute-toggle");
        const iconSoundOn = `<svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>`;
        const iconSoundOff = `<svg viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"></path></svg>`;
        let isAudioPlaying = false;
        if (audio) {
          audio.muted = true;
          if (muteBtn) muteBtn.innerHTML = iconSoundOff;
          if (muteBtn)
            muteBtn.addEventListener("click", () => {
              if (!isAudioPlaying) {
                audio.play().catch(() => {
                  /* autoplay blocked — will unmute only on user gesture */
                });
                isAudioPlaying = true;
              }
              audio.muted = !audio.muted;
              muteBtn.innerHTML = audio.muted ? iconSoundOff : iconSoundOn;
            });
        }

        // =================================================================
        // === NEW "VIEWPORT-PAGE" NAVIGATION STRATEGY ===
        // =================================================================
        const navUp = document.getElementById("nav-up");
        const navDown = document.getElementById("nav-down");

        // Ordered list of your logical sections (hero, each screen, final-content, footer)
        const sections = [
          document.querySelector("#hero"),
          ...Array.from(document.querySelectorAll(".story-container .screen")),
          document.querySelector("#final-content"),
          document.querySelector("footer"),
        ].filter(Boolean);

        // Safety: if no sections found, abort nav logic
        if (!navUp || !navDown || sections.length === 0) return;

        let isScrolling = false;
        let vh = window.innerHeight;

        // Compute a "virtual" top position for each logical section:
        // index 0 -> 0, index 1 -> 1*vh, index 2 -> 2*vh, ...
        // When scrolling to the last section, we clamp to document bottom.
        function virtualTopForIndex(index) {
          const desired = index * vh;
          const maxTop = Math.max(0, document.body.scrollHeight - vh);
          return Math.min(desired, maxTop);
        }

        // Determine the current section index based on scroll position.
        // We round to the nearest viewport "page".
        function getCurrentSectionIndex() {
          const scrollY = window.scrollY;
          const rawIndex = Math.round(scrollY / vh);
          // clamp
          return Math.max(0, Math.min(sections.length - 1, rawIndex));
        }

        // Scroll helper with safety/clamping and a short lock to avoid double clicks.
        function scrollToSection(index) {
          if (index < 0 || index >= sections.length) return;
          const top = virtualTopForIndex(index);
          isScrolling = true;
          window.scrollTo({ top, behavior: "smooth" });

          // unlock after animation expected to finish. If user interrupts, scroll events still work.
          setTimeout(() => {
            isScrolling = false;
            updateNavArrows();
          }, 700);
        }

        // Arrow click handlers
        navDown.addEventListener("click", () => {
          if (isScrolling) return;
          const cur = getCurrentSectionIndex();
          if (cur < sections.length - 1) scrollToSection(cur + 1);
        });

        navUp.addEventListener("click", () => {
          if (isScrolling) return;
          const cur = getCurrentSectionIndex();
          if (cur > 0) scrollToSection(cur - 1);
        });

        // Optional: keyboard support for ArrowUp / ArrowDown and PageUp/PageDown/Home/End
        window.addEventListener("keydown", (e) => {
          if (
            e.target &&
            (e.target.tagName === "INPUT" ||
              e.target.tagName === "TEXTAREA" ||
              e.target.isContentEditable)
          )
            return;
          if (isScrolling) return;
          const cur = getCurrentSectionIndex();
          if (e.key === "ArrowDown" || e.key === "PageDown") {
            e.preventDefault();
            if (cur < sections.length - 1) scrollToSection(cur + 1);
          } else if (e.key === "ArrowUp" || e.key === "PageUp") {
            e.preventDefault();
            if (cur > 0) scrollToSection(cur - 1);
          } else if (e.key === "Home") {
            e.preventDefault();
            scrollToSection(0);
          } else if (e.key === "End") {
            e.preventDefault();
            scrollToSection(sections.length - 1);
          }
        });

        // Update nav arrows visibility based on virtual index (top/bottom).
        function updateNavArrows() {
          const cur = getCurrentSectionIndex();
          navUp.classList.toggle("hidden", cur === 0);
          navDown.classList.toggle("hidden", cur === sections.length - 1);
        }

        // Recompute viewport height on resize (vital for consistent paging)
        let resizeTimer;
        window.addEventListener("resize", () => {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(() => {
            vh = window.innerHeight;
            // After resize, snap to the current section top so layout stays aligned
            const cur = getCurrentSectionIndex();
            window.scrollTo({
              top: virtualTopForIndex(cur),
              behavior: "instant",
            });
            updateNavArrows();
          }, 120);
        });

        // Also update arrows as user scrolls manually. Throttle a bit.
        let scrollThrottle = false;
        window.addEventListener("scroll", () => {
          if (scrollThrottle) return;
          scrollThrottle = true;
          setTimeout(() => {
            updateNavArrows();
            scrollThrottle = false;
          }, 80);
        });

        // Initial setup: snap to nearest virtual page (useful after page reload)
        (function initialSnap() {
          vh = window.innerHeight;
          const cur = getCurrentSectionIndex();
          // Immediately (no smooth) align to the virtual page top for clean state
          const top = virtualTopForIndex(cur);
          window.scrollTo({ top, behavior: "instant" });
          updateNavArrows();
        })();
      });
    </script>
  </body>
</html>